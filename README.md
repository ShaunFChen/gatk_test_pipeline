# GATK Test Pipeline

A comprehensive bioinformatics pipeline for variant calling and bisulfite conversion analysis, designed for technical interviews and educational purposes.

## 🎯 Interview Ready Features

- **Real Working Code**: Actual implementations, not pseudocode
- **Sample Data Generation**: Creates realistic genomic data for analysis  
- **Quality Assurance**: Makefile with linting, testing, and formatting
- **Documentation**: Complete setup and troubleshooting guides
- **Portable Setup**: Works on any machine with Python 3.10+ and UV

## 📋 Project Contents

### Notebooks
- **`01_variant_calling_pipeline.ipynb`**: Complete GATK best practices pipeline with real BAM/VCF generation
- **`02_bisulfite_conversion_efficiency.ipynb`**: Comprehensive bisulfite analysis with quality control

### Source Code
- **`src/variant_calling_utils.py`**: GATK command builders, performance monitoring, validation metrics
- **`src/bisulfite_utils.py`**: Bisulfite simulation, efficiency analysis, quality control

### Quality Assurance
- **Unit tests** with 12 test cases (all passing)
- **Linting and formatting** with Ruff
- **Makefile** for local verification before CI
- **Docker support** for reproducible environments

---

## 🚀 Quick Start

### Prerequisites
- **Python 3.10+** 
- **UV package manager** ([install from astral.sh/uv](https://astral.sh/uv))

### Setup
```bash
# Clone and enter directory
git clone <repository-url>
cd gatk_test_pipeline

# Create environment and install dependencies
uv venv --python 3.10
uv sync --group dev

# Verify setup
uv run python --version          # Should show Python 3.10.x
uv run python -c "import pandas; print('✅ Pandas:', pandas.__version__)"
make test                        # Should pass all 12 tests
```

### Usage
```bash
make help           # Show all available commands
make test           # Run unit tests
make jupyter        # Start Jupyter Lab
make quality-check  # Run linting, formatting, and tests
make docker-build   # Build Docker image
```

---

## 🔧 IDE Configuration

### Automatic (VS Code/Cursor)
The `.vscode/settings.json` automatically configures the Python interpreter. Just restart your IDE after setup.

### Manual Configuration
1. **Find interpreter path**: `echo "$(pwd)/.venv/bin/python"`
2. **Configure IDE**:
   - **VS Code/Cursor**: `Cmd+Shift+P` → "Python: Select Interpreter" → Navigate to `.venv/bin/python`
   - **PyCharm**: Preferences → Python Interpreter → Add → Existing Environment → Select `.venv/bin/python`

### Fix Red Underlines
If you see red underlines under imports:
1. **Restart IDE** completely
2. **Reload window**: `Cmd+Shift+P` → "Developer: Reload Window"  
3. **Clear Python cache**: `Cmd+Shift+P` → "Python: Clear Cache and Reload Window"
4. **Verify interpreter**: Should be `<project-root>/.venv/bin/python`

---

## 🧪 Technical Interview Components

### 1. Variant Calling Pipeline (GATK Best Practices)
**Interview Question**: "Develop a variant-calling pipeline using GATK best practices with performance optimization."

**Implementation**: `notebooks/01_variant_calling_pipeline.ipynb`
- Real BAM file generation with pysam
- GATK command building and execution
- Performance monitoring and optimization
- Quality assessment and validation
- Visualization of results

**Key Topics**:
- GATK HaplotypeCaller workflow
- Performance bottlenecks and solutions
- Quality control metrics (Ti/Tv ratio, coverage, etc.)
- Parallelization strategies
- Memory optimization

### 2. Bisulfite Conversion Efficiency Analysis
**Interview Question**: "Analyze bisulfite conversion efficiency with quality control and computational approaches."

**Implementation**: `notebooks/02_bisulfite_conversion_efficiency.ipynb`
- Realistic bisulfite sequencing data simulation
- Conversion efficiency calculation
- Lambda DNA control analysis
- Quality control metrics
- Comprehensive visualizations

**Key Topics**:
- Bisulfite sequencing principles
- Conversion efficiency calculation methods
- Quality control strategies
- Statistical analysis approaches
- Data visualization techniques

---

## 🐳 Docker Support

### Build and Run
```bash
make docker-build
make docker-run
```

### Manual Docker Commands
```bash
docker build -t gatk-pipeline .
docker run -it --rm -v $(pwd):/project gatk-pipeline
```

The Docker image includes all bioinformatics tools (GATK, BWA, samtools, etc.) and Python dependencies.

---

## 📁 Project Structure

```
gatk_test_pipeline/
├── .venv/                 # Virtual environment
├── .vscode/              # VS Code configuration
├── data/                 # Input data (generated by notebooks)
├── notebooks/            # Jupyter notebooks with implementations
│   ├── 01_variant_calling_pipeline.ipynb
│   └── 02_bisulfite_conversion_efficiency.ipynb
├── src/                  # Source code utilities
│   ├── variant_calling_utils.py
│   └── bisulfite_utils.py
├── tests/               # Unit tests
├── scripts/             # Project initialization scripts
├── Dockerfile           # Container configuration
├── Makefile            # Development commands
├── pyproject.toml      # Dependencies and configuration
└── README.md           # This file
```

---

## 🛠️ Troubleshooting

### Import Errors in Notebooks
Add this to the first cell of notebooks:
```python
import sys
import os
sys.path.append(os.path.join(os.path.dirname(os.getcwd()), 'src'))
```

### Environment Issues
```bash
# Clean reinstall
rm -rf .venv
uv venv --python 3.10
uv sync --group dev

# Verify everything works
make test
```

### IDE Python Path Issues
```bash
# Find correct path
echo "$(pwd)/.venv/bin/python"

# Alternative methods
uv run which python
realpath .venv/bin/python
```

### Platform-Specific Notes

#### macOS
- Uses Homebrew Python: `/usr/local/opt/python@3.10/bin/python3.10`
- May need: `xcode-select --install`

#### Linux  
- May need: `sudo apt-get install build-essential`

#### Windows
- Use PowerShell or Git Bash
- Replace `make` with `uv run` commands if needed

---

## 🧬 Bioinformatics Tools

The project includes interfaces for:
- **GATK**: Variant calling and analysis
- **BWA**: Read alignment  
- **samtools/pysam**: BAM file manipulation
- **bcftools**: VCF file processing
- **FastQC**: Quality control

All tools are available in the Docker container, or install locally as needed.

---

## 📊 Quality Metrics

### Test Coverage
- **12 unit tests** covering all major functionality
- **Command building**: GATK, performance monitoring
- **Data processing**: Validation metrics, utility functions
- **Integration tests**: End-to-end pipeline workflows

### Code Quality
- **Linting**: Ruff with comprehensive rules
- **Formatting**: Automatic code formatting
- **Type hints**: For better code documentation
- **Documentation**: Comprehensive docstrings

---

## 🎓 Educational Use

This project serves as:
- **Interview preparation** for data science/bioinformatics roles
- **Learning resource** for GATK best practices
- **Template** for bioinformatics projects
- **Reference implementation** of common workflows

Feel free to modify and extend for your specific needs!

---

## 📄 License

This project is for educational and interview preparation purposes. Feel free to use and modify as needed.
